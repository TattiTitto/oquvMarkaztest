<a href="/"><button class="btn btn-dark m-3"><h5 class="m-0">Home</h5></button></a>
<div class="container text-center">
    <% teachers %>
    <% groups %>
    <% students %>
    <% subjects %>
    <% conTS %>

    <div class="modal fade" id="addTeacher" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><h2 class="mt-2 mb-2">Add teacher</h2></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="/teacher" method="post" class="card-body justify-content-center">
                        <div class="form-group d-flex justify-content-between w-100 text-center">
                            <label for="add" class="p-2"><h4 class="p-0" style="font-size: 20px;">Add teacher</h4></label>
                            <input readonly required name="add" type="text" value="teacher" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;">
                        </div>
                        <div class="form-group mt-2 d-flex justify-content-between w-100 text-center">
                            <label for="name" class="p-2"><h4 class="p-0" style="font-size: 20px;">Name</h4></label>
                            <input required name="name" type="text" placeholder="Teacher's name" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;">
                        </div>
                        <div class="form-group mt-2 d-flex justify-content-between w-100 text-center">
                            <label for="surname" class="p-2"><h4 class="p-0" style="font-size: 20px;">Surname</h4></label>
                            <input required name="surname" type="text" placeholder="Teacher's surname" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;">
                        </div>
                        <div class="form-group mt-2 d-flex justify-content-between w-100 text-center">
                            <label for="number" class="p-2"><h4 class="p-0" style="font-size: 20px;">Phone Number</h4></label>
                            <input required name="number" type="number" placeholder="Teacher's phone number" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;">
                        </div>
                        <div class="form-group mt-2 d-flex justify-content-between w-100 text-center">
                            <label for="gender" class="p-2"><h4 class="p-0" style="font-size: 20px;">Gender</h4></label>
                            <div class="d-flex justify-content-around align-items-center" style="font-size: 22px;width: 63%;">
                                <div>
                                    <label for="male">Male</label>
                                    <input checked value=true type="radio" id="male" name="gender">
                                </div>
                                <div>
                                    <label for="female">Female</label>
                                    <input value=false type="radio" id="female" name="gender">
                                </div>
                            </div>
                        </div>
                        <a href="/teacher"><button class="btn btn-success mt-2 w-50 p-2" type="submit"><h4 class="m-0">Add</h4></button></a>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addSubject" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><h2 class="mt-2 mb-2">Add Subject</h2></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="/teacher" method="post" class="card-body justify-content-center">
                        <div class="form-group d-flex justify-content-between w-100 text-center">
                            <label for="add" class="p-2"><h4 class="p-0" style="font-size: 20px;">Add subject</h4></label>
                            <input readonly required name="add" type="text" value="subject" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;">
                        </div>
                        <div class="form-group mt-2 d-flex justify-content-between w-100 text-center">
                            <label for="teacher" class="p-2"><h4 class="p-0" style="font-size: 20px;">Teacher</h4></label>
                            <input readonly required name="teacher" id="teacher" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;">
                        </div>
                        <div class="form-group mt-2 d-flex justify-content-between w-100 text-center">
                            <label for="subject" class="p-2"><h4 class="p-0" style="font-size: 20px;">Subject</h4></label>
                            <select required name="subject" id="subject" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;"></select>
                        </div>
                        <a href="/teacher"><button class="btn btn-success mt-2 w-50 p-2" type="submit"><h4 class="m-0">Add</h4></button></a>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="remove" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><h2 class="mt-2 mb-2">Remove</h2></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="/teacher" method="post" class="card-body justify-content-center">
                        <div class="form-group d-flex justify-content-between w-100 text-center">
                            <label for="remove" class="p-2"><h4 class="p-0" style="font-size: 20px;">Remove</h4></label>
                            <input readonly required name="remove" type="text" id="roll" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;">
                        </div>
                        <div class="form-group mt-2 d-flex justify-content-between w-100 text-center">
                            <label for="name" class="p-2"><h4 class="p-0" style="font-size: 20px;">Name</h4></label>
                            <input readonly required name="name" id="name" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;">
                        </div>
                        <div class="form-group mt-2 d-none justify-content-between w-100 text-center">
                            <label for="conid" class="p-2"><h4 class="p-0" style="font-size: 20px;">Connection ID</h4></label>
                            <input readonly required name="conid" id="conid" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;">
                        </div>
                        <div class="form-group mt-2 d-flex justify-content-between w-100 text-center">
                            <label for="id" class="p-2"><h4 class="p-0" style="font-size: 20px;">ID</h4></label>
                            <input readonly required name="id" id="id" class="btn border-primary text-dark p-2" style="font-size: 22px;width: 63%;">
                        </div>
                        <a href="/teacher"><button class="btn btn-success mt-2 w-50 p-2" type="submit"><h4 class="m-0">Remove</h4></button></a>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-4">
            <div class="card">
                <div class="card-header bg-primary"><h3>Teachers</h3></div>
                <div class="card-body pb-0" id="teach">
                    <% for(var i=0; i < teachers.length; i++) { %>
                        <% if (teachers[i].name != '') { %>
                            <a style="text-decoration: none;">
                                <div class="btn-group w-100 mb-3">
                                    <button type="submit" onclick="teacher('<%= teachers[i].id %>', '<%= i %>')" class="a btn teacher d-block btn-success p-2 w-75"><h5 class="m-0"><%- teachers[i].name %></h5></button>
                                    <button type="submit" data-toggle="modal" data-target="#remove" class="btn p-0 btn-danger bi bi-trash-fill" onclick="remove('teachers', '<%= teachers[i].name %>', '<%= teachers[i].id %>', 0)"></button>
                                </div>
                            </a>
                        <% } %>
                    <% } %>
                    <button class="btn w-75 btn-success mb-3" data-toggle="modal" data-target="#addTeacher"><h5 class="m-0">Add Teacher</h5></button>
                </div>
            </div>
        </div>

        <div class="col-4">
            <div class="card">
                <div class="card-header bg-primary"><h3>Subjects</h3></div>
                <div class="card-body pb-0" id="subjectItems"></div>
            </div>
        </div>

        <div class="col-4">
            <div class="card">
                <div class="card-header bg-primary"><h3>Groups</h3></div>
                <div class="card-body pb-0" id="groups"></div>
            </div>
        </div>
    </div>
</div>
<script>
    var teachers = JSON.parse('<%- JSON.stringify(teachers) %>'), 
    groups = JSON.parse('<%- JSON.stringify(groups) %>'), 
    students = JSON.parse('<%- JSON.stringify(students) %>'), 
    subjects = JSON.parse('<%- JSON.stringify(subjects) %>'), 
    conTS = JSON.parse('<%- JSON.stringify(conTS) %>');
    
    var techId, subId, grId
    function teacher(id, count) {
        techId = id
        subId = null
        grId = null
        document.querySelectorAll('.teacher').forEach(item => item.classList.remove('btn-danger'))
        document.querySelectorAll('.teacher').item(count).classList.add('btn-danger')

        var sub = ""
        for (let i = 0, k = 0; i < conTS.length; i++)
            if(conTS[i].teacher_id == id)
                for (let j = 0; j < subjects.length; j++)
                    if(subjects[j].id == conTS[i].subject_id) {
                        sub += '<div class="btn-group w-100 mb-3"><button onclick="subject(' + conTS[i].subject_id + ", "+ k +')" class="btn subject w-75 btn-warning p-2"><h5 class="m-0">' + subjects[j].name + "</h5></button>\n"+
                        `<button type="submit" data-toggle="modal" data-target="#remove" class="btn p-0 btn-danger bi bi-trash-fill" onclick="remove('Teacher\`s subject', '`+subjects[j].name+`', '`+subjects[j].id+`', '`+id+`')"></button></div>`
                        k++
                    }
        sub += '<button data-toggle="modal" data-target="#addSubject" onclick="addSubject()" class="btn w-75 btn-success mb-3"><h5 class="m-0">Add Subject</h5></button>'
        document.getElementById('subjectItems').innerHTML = sub

        var gr = ""
        for (let i = 0; i < groups.length; i++) if(groups[i].teacher_id == techId) 
            gr += '<div class="btn-group w-100 mb-3"><button class="btn w-75 group d-block btn-warning p-2"><h5 class="m-0">' + groups[i].name + "</h5></button>\n"+`<button type="submit" data-toggle="modal" data-target="#remove" class="btn p-0 btn-danger bi bi-trash-fill" onclick="remove('groups', '`+groups[i].name+`', '`+groups[i].id+`', 0)"></button></div>`
        document.getElementById('groups').innerHTML = gr
    }

    function subject(id, count) {
        subId = id
        document.querySelectorAll('.subject').forEach(item => item.classList.remove('btn-danger'))
        document.querySelectorAll('.subject').item(count).classList.add('btn-danger')

        var gr = "", t = 0
        for (let i = 0; i < groups.length; i++) if(groups[i].teacher_id == techId && groups[i].subject_id == id) {
            gr += '<div class="btn-group w-100 mb-3"><button class="btn w-75 group d-block btn-warning p-2"><h5 class="m-0">' + groups[i].name + "</h5></button>\n"+
            `<button type="submit" data-toggle="modal" data-target="#remove" class="btn p-0 btn-danger bi bi-trash-fill" onclick="remove('groups', '`+groups[i].name+`', ${groups[i].id}, ${groups[i].teacher_id})"></button></div>`
            t++
        }
        document.getElementById('groups').innerHTML = gr
    }

    function addSubject() {
        var sub = ""
        for (let i = 0, t = 0; i < subjects.length; i++, t = 0) {
            for (let j = 0; j < conTS.length; j++) 
                if(subjects[i].id == conTS[j].subject_id && techId == conTS[j].teacher_id) t++
            if(t == 0) sub += `<option value="${subjects[i].name}">` + subjects[i].name + '</option>\n'
        }
        document.querySelector('#subject').innerHTML = sub
        for (let i = 0; i < teachers.length; i++) if(teachers[i].id == techId) document.querySelector('#teacher').defaultValue = teachers[i].name
    }

    function remove(table, name, id, conid) {
        document.getElementById('roll').defaultValue = table
        document.getElementById('name').defaultValue = name
        document.getElementById('id').defaultValue = id
        document.getElementById('conid').defaultValue = conid
        if(conid != 0) document.getElementById('conid').defaultValue = conid
    }
</script>
